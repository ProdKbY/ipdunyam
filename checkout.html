<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SipariÅŸ Onay | Ä°P DÃœNYAM</title>
  <link rel="stylesheet" href="css/style.css?v=10" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Open+Sans&display=swap" rel="stylesheet">
</head>
<body>

<header class="navbar">
  <div class="nav-top">
   <a class="logo" href="index.html" aria-label="Ä°P DÃœNYAM Anasayfa">
  <img src="images/logo.svg" alt="Ä°P DÃœNYAM" class="logo-img">
</a>

    <button class="nav-toggle" id="navToggle" aria-label="MenÃ¼yÃ¼ aÃ§/kapat">â˜°</button>
  </div>

  <nav id="mainNav">
    <ul>
      <li><a href="index.html">Ana Sayfa</a></li>
      <li><a href="products.html">ÃœrÃ¼nler</a></li>
      <li><a href="about.html">HakkÄ±mda</a></li>
      <li><a href="contact.html">Ä°letiÅŸim</a></li>

      <li>
        <a class="cart-link" href="cart.html" aria-label="Sepetim">
          <span class="cart-icon">ğŸ›’</span>
          <span id="cart-count">0</span>
        </a>
      </li>

      <li><a href="login.html" id="profile-link" class="profile-link">ğŸ‘¤ GiriÅŸ Yap</a></li>
    </ul>
  </nav>
</header>

<section class="checkout-page">
  <h1 class="page-title">SipariÅŸ Onay</h1>

  <div class="checkout-grid">
    <div class="card checkout-card">
      <h2 class="card-title">SipariÅŸ Ã–zeti</h2>

      <div id="checkout-items" class="summary-items"></div>

      <div class="summary-line">
        <span>Ara Toplam</span>
        <span id="subtotal">0 TL</span>
      </div>

      <div class="summary-line">
        <span>Kargo</span>
        <span id="shipping-fee">0 TL</span>
      </div>

      <div class="summary-total">
        <span>Genel Toplam</span>
        <strong id="grand-total">0 TL</strong>
      </div>

      <p id="stock-note" class="mini-note">Sepetiniz boÅŸ ğŸ§º</p>
    </div>

    <div class="card checkout-card">
      <h2 class="card-title">Teslimat & Ã–deme</h2>

      <form id="checkout-form" class="checkout-form">
        <div class="form-group">
          <label>Ad Soyad</label>
          <input id="fullname" type="text" placeholder="Ad Soyad" required />
        </div>

        <div class="form-group">
          <label>Telefon</label>
          <input id="phone" type="tel" placeholder="05xx xxx xx xx" required />
        </div>

        <div class="form-group">
          <label>Adres</label>
          <textarea id="address" placeholder="Adresinizi yazÄ±n" required></textarea>
        </div>

        <div class="form-group">
          <label>Kargo</label>
          <select id="shipping">
            <option value="Standart">Standart Kargo</option>
            <option value="HÄ±zlÄ±">HÄ±zlÄ± Kargo</option>
          </select>
        </div>

        <div class="form-group">
          <label>Ã–deme YÃ¶ntemi</label>
          <select id="payment">
            <option value="Havale/EFT">Havale / EFT</option>
            <option value="Shopier">Shopier</option>
            <option value="KapÄ±da Ã–deme">KapÄ±da Ã–deme</option>
          </select>
        </div>

        <div id="pay-info" class="pay-info">Havale/EFT seÃ§ildi. IBAN bilgisi sipariÅŸ mesajÄ±na eklenecek.</div>

        <div class="form-group">
          <label>SipariÅŸ Notu</label>
          <textarea id="note" placeholder="Ä°sterseniz sipariÅŸ notu ekleyin"></textarea>
        </div>

        <button class="btn btn-full" type="submit">SipariÅŸi Tamamla</button>
        <p class="checkout-hint">â€œSipariÅŸi Tamamlaâ€ dediÄŸinizde WhatsApp Ã¼zerinden sipariÅŸ mesajÄ±nÄ±z hazÄ±rlanÄ±r.</p>
      </form>
    </div>
  </div>
</section>

<footer class="footer">
  <p>Â© 2026 Ä°P DÃœNYAM | TÃ¼m haklarÄ± saklÄ±dÄ±r.</p>
  <div class="footer-links">
    <a href="kvkk.html">KVKK & Gizlilik</a>
    <a href="iade.html">Ä°ade / Ä°ptal</a>
    <a href="mesafeli-satis.html">Mesafeli SatÄ±ÅŸ</a>
  </div>
<p class="powered-by">Powered by <strong>Devrim KoÃ§</strong></p>
</footer>

<script src="js/main.js"></script>

<!-- Checkout script (senin Ã§alÄ±ÅŸan sÃ¼rÃ¼mÃ¼n) -->
<script>
  const SHIPPING_PRICES = { Standart: 60, "HÄ±zlÄ±": 90 };
  const YOUR_WA_NUMBER = "905348494028";
const SHOPIER_LINK = "Shopier linkiniz buraya";

  const isLoggedIn = localStorage.getItem("isLoggedIn");
  const user = JSON.parse(localStorage.getItem("user") || "null");
  if (isLoggedIn !== "true" || !user) {
    alert("SipariÅŸ vermek iÃ§in giriÅŸ yapmalÄ±sÄ±nÄ±z.");
    window.location.href = "login.html";
  }

  const itemsEl = document.getElementById("checkout-items");
  const subtotalEl = document.getElementById("subtotal");
  const shippingFeeEl = document.getElementById("shipping-fee");
  const grandTotalEl = document.getElementById("grand-total");
  const stockNote = document.getElementById("stock-note");

  const fullnameEl = document.getElementById("fullname");
  const phoneEl = document.getElementById("phone");
  const addressEl = document.getElementById("address");
  const shippingEl = document.getElementById("shipping");
  const paymentEl = document.getElementById("payment");
  const payInfoEl = document.getElementById("pay-info");
  const noteEl = document.getElementById("note");

  let cartLocal = JSON.parse(localStorage.getItem("cart") || "[]");

  fullnameEl.value = user.fullname || "";
  phoneEl.value = user.phone || "";
  addressEl.value = user.address || "";

  function parsePrice(value) {
    if (value === null || value === undefined) return 0;
    const cleaned = String(value).replace(",", ".").replace(/[^0-9.]/g, "");
    return Number(cleaned) || 0;
  }

  function calcSubtotal() {
    return cartLocal.reduce((sum, item) => sum + parsePrice(item.price), 0);
  }

  function getShippingFee() {
    return SHIPPING_PRICES[shippingEl.value] || 0;
  }

  function renderSummary() {
    itemsEl.innerHTML = "";

    if (!cartLocal || cartLocal.length === 0) {
      itemsEl.innerHTML = `<p class="empty">Sepetiniz boÅŸ ğŸ§º</p>`;
      subtotalEl.textContent = "0 TL";
      shippingFeeEl.textContent = "0 TL";
      grandTotalEl.textContent = "0 TL";
      if (stockNote) stockNote.style.display = "block";
      return;
    }

    if (stockNote) stockNote.style.display = "none";

    cartLocal.forEach((item) => {
      const div = document.createElement("div");
      div.className = "summary-item";
      div.innerHTML = `
        <span class="item-name">${item.name}</span>
        <span class="item-price">${parsePrice(item.price)} TL</span>
      `;
      itemsEl.appendChild(div);
    });

    const subtotal = calcSubtotal();
    const shippingFee = getShippingFee();
    const grandTotal = subtotal + shippingFee;

    subtotalEl.textContent = `${subtotal} TL`;
    shippingFeeEl.textContent = `${shippingFee} TL`;
    grandTotalEl.textContent = `${grandTotal} TL`;
  }

  function updatePaymentInfo() {
    const method = paymentEl.value;
    if (method === "Havale/EFT") {
      payInfoEl.textContent = "Havale/EFT seÃ§ildi. IBAN bilgisi sipariÅŸ mesajÄ±na eklenecek.";
    } else if (method === "Shopier") {
      payInfoEl.textContent = "Shopier seÃ§ildi. SipariÅŸ sonrasÄ± Shopier Ã¶deme linki paylaÅŸÄ±lacak.";
    } else {
      payInfoEl.textContent = "KapÄ±da Ã¶deme seÃ§ildi. Teslimatta Ã¶deme alÄ±nÄ±r.";
    }
  }

  updatePaymentInfo();
  renderSummary();

  shippingEl.addEventListener("change", () => {
    cartLocal = JSON.parse(localStorage.getItem("cart") || "[]");
    renderSummary();
  });

  paymentEl.addEventListener("change", updatePaymentInfo);

  document.getElementById("checkout-form").addEventListener("submit", (e) => {
    e.preventDefault();

    cartLocal = JSON.parse(localStorage.getItem("cart") || "[]");
    if (!cartLocal || cartLocal.length === 0) {
      alert("Sepetiniz boÅŸ. LÃ¼tfen Ã¼rÃ¼n ekleyin.");
      return;
    }

    const fullname = fullnameEl.value.trim();
    const phone = phoneEl.value.trim();
    const address = addressEl.value.trim();
    const shipping = shippingEl.value;
    const payment = paymentEl.value;
    const note = noteEl.value.trim();

    user.address = address;
    localStorage.setItem("user", JSON.stringify(user));

    const subtotal = calcSubtotal();
    const shippingFee = getShippingFee();
    const grandTotal = subtotal + shippingFee;

    const paymentExtra =
      payment === "Havale/EFT"
        ? `

ğŸ’³ Ã–deme: Havale/EFT seÃ§ildi.
IBAN bilgisi sipariÅŸ sonrasÄ± WhatsApp Ã¼zerinden paylaÅŸÄ±lacaktÄ±r.`
        : payment === "Shopier"
        ? `

ğŸ”— Shopier:
${SHOPIER_LINK}`
        : "";

    const orderText =
`Merhaba, Ä°P DÃœNYAM Ã¼zerinden sipariÅŸ vermek istiyorum ğŸ§¶

ğŸ‘¤ Ad Soyad: ${fullname}
ğŸ“ Telefon: ${phone}
ğŸ“ Adres: ${address}

ğŸšš Kargo: ${shipping} (${shippingFee} TL)
ğŸ’³ Ã–deme: ${payment}

ğŸ›’ ÃœrÃ¼nler:
${cartLocal.map(i => `- ${i.name} (${parsePrice(i.price)} TL)`).join("\n")}

ğŸ§¾ Ara Toplam: ${subtotal} TL
ğŸ“¦ Kargo: ${shippingFee} TL
ğŸ’° Genel Toplam: ${grandTotal} TL

ğŸ“ Not: ${note || "Yok"}${paymentExtra}`;

    const waUrl = `https://wa.me/${YOUR_WA_NUMBER}?text=${encodeURIComponent(orderText)}`;
    window.open(waUrl, "_blank");
  });
</script>

  </body>
</html>
