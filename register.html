<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KayÄ±t Ol | Ä°P DÃœNYAM</title>
  <link rel="stylesheet" href="css/style.css" />

  <style>
    .auth-wrap{max-width:520px;margin:24px auto;padding:18px}
    .auth-card{border:1px solid rgba(0,0,0,.08);border-radius:16px;padding:18px}
    .auth-title{margin:0 0 6px;font-size:26px}
    .auth-sub{margin:0 0 14px;color:#666;font-size:14px}
    .auth-row{display:flex;flex-direction:column;gap:8px;margin:12px 0}
    .auth-row label{font-size:13px;color:#333}
    .auth-input{width:100%;padding:12px 12px;border:1px solid rgba(0,0,0,.12);border-radius:12px;outline:none}
    .auth-input:focus{border-color:rgba(0,0,0,.35)}
    .auth-actions{display:flex;gap:10px;align-items:center;margin-top:14px}
    .auth-btn{width:100%;padding:12px 14px;border:0;border-radius:12px;cursor:pointer}
    .auth-btn.primary{background:#111;color:#fff}
    .auth-btn.primary:disabled{opacity:.6;cursor:not-allowed}
    .auth-link{display:inline-block;margin-top:12px;color:#111;text-decoration:underline;font-size:14px}
    .auth-msg{display:none;margin-top:12px;padding:10px 12px;border-radius:12px;font-size:14px}
    .auth-msg.error{display:block;background:rgba(220,38,38,.10);color:#b91c1c;border:1px solid rgba(220,38,38,.20)}
    .auth-msg.ok{display:block;background:rgba(34,197,94,.10);color:#166534;border:1px solid rgba(34,197,94,.20)}
    .pw-wrap{display:flex;gap:10px;align-items:center}
    .pw-wrap .auth-input{flex:1}
    .pw-toggle{padding:10px 12px;border:1px solid rgba(0,0,0,.12);border-radius:12px;background:#fff;cursor:pointer;white-space:nowrap}
  </style>
</head>

<body>
  <header class="header">
    <div class="nav-top">
      <a class="logo" href="index.html">Ä°P DÃœNYAM</a>
      <button id="navToggle" class="nav-toggle" aria-label="MenÃ¼yÃ¼ AÃ§/Kapat">â˜°</button>
      <nav id="mainNav" class="nav">
        <a href="products.html">ÃœrÃ¼nler</a>
        <a href="cart.html">Sepet (<span id="cart-count">0</span>)</a>
        <a id="profile-link" href="login.html">GiriÅŸ Yap</a>
      </nav>
    </div>
  </header>

  <main class="auth-wrap">
    <section class="auth-card">
      <h1 class="auth-title">KayÄ±t Ol</h1>
      <p class="auth-sub">HÄ±zlÄ±ca hesap oluÅŸtur, giriÅŸ yap ve sipariÅŸ adÄ±mlarÄ±nÄ± kolaylaÅŸtÄ±r.</p>

      <div id="msg" class="auth-msg"></div>

      <form id="registerForm" novalidate>
        <div class="auth-row">
          <label for="regName">Ad Soyad</label>
          <input class="auth-input" id="regName" type="text" autocomplete="name" required />
        </div>

        <div class="auth-row">
          <label for="regEmail">E-posta</label>
          <input class="auth-input" id="regEmail" type="email" autocomplete="email" inputmode="email" required />
        </div>

        <div class="auth-row">
          <label for="regPassword">Åifre</label>
          <div class="pw-wrap">
            <input class="auth-input" id="regPassword" type="password" autocomplete="new-password" required />
            <button type="button" class="pw-toggle" id="pwToggle">GÃ¶ster</button>
          </div>
          <small style="color:#666;font-size:12px;line-height:1.35">
            En az 6 karakter kullanmanÄ± Ã¶neririm.
          </small>
        </div>

        <div class="auth-actions">
          <button class="auth-btn primary" id="submitBtn" type="submit">KayÄ±t Ol</button>
        </div>

        <a class="auth-link" href="login.html">Zaten hesabÄ±n var mÄ±? GiriÅŸ yap</a>
      </form>
    </section>
  </main>

  <footer class="footer">
    <p>Â© 2026 Ä°P DÃœNYAM</p>
  </footer>

  <script src="js/main.js"></script>
  <!-- Cloudflare Turnstile -->
<div class="cf-turnstile"
     data-sitekey="0x4AAAAAACMecyCsf8nhKqp6"
     data-callback="onTurnstileOk"
     data-expired-callback="onTurnstileExpired"></div>

<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

<script>
  // Turnstile token (frontend gate)
  window.__tsToken = "";
  function onTurnstileOk(token) { window.__tsToken = token; }
  function onTurnstileExpired() { window.__tsToken = ""; }
</script>


<script type="module">
  import { auth } from "./js/firebase.js";
  import {
    createUserWithEmailAndPassword,
    updateProfile,
    sendEmailVerification,
    signOut
  } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

  document.getElementById("registerForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    // ğŸ” BOT KONTROL
    if (!window.__tsToken) {
      alert("LÃ¼tfen 'Ben robot deÄŸilim' doÄŸrulamasÄ±nÄ± yap.");
      return;
    }

    const name = regName.value.trim();
    const email = regEmail.value.trim().toLowerCase();
    const password = regPassword.value;

    if (!name || !email || !password) {
      alert("LÃ¼tfen tÃ¼m alanlarÄ± doldurun.");
      return;
    }

    try {
      const cred = await createUserWithEmailAndPassword(auth, email, password);
      await updateProfile(cred.user, { displayName: name });

      // ğŸ“§ DoÄŸrulama maili
      await sendEmailVerification(cred.user);

      // doÄŸrulanana kadar Ã§Ä±kÄ±ÅŸ
      await signOut(auth);

      alert("DoÄŸrulama maili gÃ¶nderildi. Mailini doÄŸruladÄ±ktan sonra giriÅŸ yapabilirsin.");
      window.location.href = "verify.html";
    } catch (err) {
      alert(err.message || "KayÄ±t sÄ±rasÄ±nda hata oluÅŸtu.");
    }
  });
</script>


  
</body>
</html>

